FROM ubuntu
RUN apt-get update \
    && apt-get -y install adduser apt apt-utils base-files base-passwd bash bsdutils busybox-initramfs bzip2 ca-certificates console-setup coreutils cpio cron curl dash debconf debconf-i18n debianutils dh-python diffutils dmsetup dpkg e2fslibs:amd64 e2fsprogs eject file findutils fontconfig-config fonts-dejavu-core freetds-common gcc-4.8-base:amd64 gcc-4.9-base:amd64 geoip-database git git-man gnupg gpgv grep gzip hostname ifupdown init-system-helpers initramfs-tools initramfs-tools-bin initscripts insserv iproute2 iputils-ping isc-dhcp-client isc-dhcp-common kbd keyboard-configuration klibc-utils kmod krb5-locales less libacl1:amd64 libapt-inst1.5:amd64 libapt-pkg4.12:amd64 libarchive-extract-perl libasn1-8-heimdal:amd64 libattr1:amd64 libaudit-common libaudit1:amd64 libblkid1:amd64 libbsd0:amd64 libbz2-1.0:amd64 libc-bin libc6:amd64 libcap2:amd64 libcap2-bin libcgmanager0:amd64 libcomerr2:amd64 libcurl3:amd64 libcurl3-gnutls:amd64 libdb5.3:amd64 libdbus-1-3:amd64 libdebconfclient0:amd64 libdevmapper1.02.1:amd64 libdrm2:amd64 libedit2:amd64 liberror-perl libestr0 libexpat1:amd64 libffi6:amd64 libfontconfig1:amd64 libfreetype6:amd64 libfribidi0:amd64 libgcc1:amd64 libgcrypt11:amd64 libgd3:amd64 libgdbm3:amd64 libgeoip1:amd64 libgnutls-openssl27:amd64 libgnutls26:amd64 libgpg-error0:amd64 libgpm2:amd64 libgssapi-krb5-2:amd64 libgssapi3-heimdal:amd64 libhcrypto4-heimdal:amd64 libheimbase1-heimdal:amd64 libheimntlm0-heimdal:amd64 libhx509-5-heimdal:amd64 libidn11:amd64 libjbig0:amd64 libjpeg-turbo8:amd64 libjpeg8:amd64 libjson-c2:amd64 libjson0:amd64 libk5crypto3:amd64 libkeyutils1:amd64 libklibc libkmod2:amd64 libkrb5-26-heimdal:amd64 libkrb5-3:amd64 libkrb5support0:amd64 libldap-2.4-2:amd64 liblocale-gettext-perl liblockfile-bin liblockfile1:amd64 liblog-message-simple-perl liblzma5:amd64 libmagic1:amd64 libmcrypt4 libmemcached10:amd64 libmodule-pluggable-perl libmount1:amd64 libmpdec2:amd64 libmysqlclient18:amd64 libncurses5:amd64 libncursesw5:amd64 libnewt0.52:amd64 libnih-dbus1:amd64 libnih1:amd64 libp11-kit0:amd64 libpam-cap:amd64 libpam-modules:amd64 libpam-modules-bin libpam-runtime libpam0g:amd64 libpcre3:amd64 libplymouth2:amd64 libpng12-0:amd64 libpod-latex-perl libpopt0:amd64 libprocps3:amd64 libpython-stdlib:amd64 libpython2.7:amd64 libpython2.7-minimal:amd64 libpython2.7-stdlib:amd64 libpython3-stdlib:amd64 libpython3.4-minimal:amd64 libpython3.4-stdlib:amd64 libreadline6:amd64 libroken18-heimdal:amd64 librtmp0:amd64 libsasl2-2:amd64 libsasl2-modules:amd64 libsasl2-modules-db:amd64 libselinux1:amd64 libsemanage-common libsemanage1:amd64 libsepol1:amd64 libslang2:amd64 libsqlite3-0:amd64 libss2:amd64 libssl1.0.0:amd64 libstdc++6:amd64 libsybdb5:amd64 libsystemd-daemon0:amd64 libtasn1-6:amd64 libterm-ui-perl libtext-charwidth-perl libtext-iconv-perl libtext-soundex-perl libtext-wrapi18n-perl libtiff5:amd64 libtinfo5:amd64 libudev1:amd64 libusb-0.1-4:amd64 libustr-1.0-1:amd64 libuuid1:amd64 libvpx1:amd64 libwind0-heimdal:amd64 libx11-6:amd64 libx11-data libxau6:amd64 libxcb1:amd64 libxdmcp6:amd64 libxext6:amd64 libxml2:amd64 libxmuu1:amd64 libxpm4:amd64 libxslt1.1:amd64 locales lockfile-progs login logrotate lsb-base lsb-release lsof makedev mawk mime-support module-init-tools mount mountall multiarch-support mysql-common ncurses-base ncurses-bin net-tools netbase netcat-openbsd nginx nginx-common nginx-core ntpdate openssh-client openssl passwd patch perl perl-base perl-modules php-pear php5-cli php5-common php5-curl php5-fpm php5-gd php5-json php5-ldap php5-mcrypt php5-memcache php5-memcached php5-mysql php5-readline php5-sybase plymouth procps psmisc python python-minimal python2.7 python2.7-minimal python3 python3-minimal python3.4 python3.4-minimal readline-common resolvconf rsync rsyslog sed sensible-utils sgml-base sudo sysv-rc sysvinit-utils tar tzdata ubuntu-keyring ubuntu-minimal ucf udev unzip upstart ureadahead util-linux vim vim-common vim-runtime vim-tiny wget whiptail xauth xkb-data xml-core zip zlib1g:amd64 \
    && echo '#start php5-fpm'                >>/etc/bash.bashrc \
    && echo 'if ! pgrep php5-fpm >/dev/null' >>/etc/bash.bashrc \
    && echo 'then'                           >>/etc/bash.bashrc \
    && echo '  service php5-fpm start'       >>/etc/bash.bashrc \
    && echo 'fi'                             >>/etc/bash.bashrc \
    && echo '#start nginx'                   >>/etc/bash.bashrc \
    && echo 'if ! pgrep nginx >/dev/null'    >>/etc/bash.bashrc \
    && echo 'then'                           >>/etc/bash.bashrc \
    && echo '  service nginx start'          >>/etc/bash.bashrc \
    && echo 'fi'                             >>/etc/bash.bashrc \
    && mkdir /hcpss-simpleSAMLphp \
    && ln -s /hcpss-simpleSAMLphp/www /usr/share/nginx/html/saml \
    && ln -s /etc/php5/mods-available/mcrypt.ini /etc/php5/fpm/conf.d/20-mcrypt.ini \
    && mkdir /var/log/saml/ \
    && touch /var/log/saml/simplesamlphp.log \
    && chown www-data /var/log/saml/simplesamlphp.log
COPY www.conf /etc/php5/fpm/pool.d/
COPY fastcgi_params /etc/nginx/
COPY default /etc/nginx/sites-available/
